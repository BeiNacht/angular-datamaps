angular.module("datamaps",[]),define(function(a){var b=a("d3"),c=(a("topojson"),a("datamaps"));angular.module("datamaps").directive("datamap",["$window",function(a){return{restrict:"EA",scope:{map:"=",plugins:"=?",zoomable:"@?",onClick:"&?",pluginData:"=",api:"=?"},link:function(d,e,f){function g(){return{element:e[0],scope:"usa",height:d.height,width:d.width,aspectRatio:d.aspectRatio,fills:{defaultFill:"#b9b9b9"},data:{},done:function(a){function c(){a.svg.selectAll("g").attr("transform","translate("+b.event.translate+")scale("+b.event.scale+")")}h=b.behavior.zoom().scaleExtent([1,10]).on("zoom",c),angular.isDefined(f.onClick)&&a.svg.selectAll(".datamaps-subunit").on("click",function(a){d.onClick()(a)}),angular.isDefined(f.zoomable)&&a.svg.call(h)}}}var h;d.api={refresh:function(a){d.api.updateWithOptions(a)},updateWithOptions:function(b){d.api.clearElement(),d.width=(b.options||{}).width||null,d.height=(b.options||{}).height||(d.width?.5*d.width:null),d.aspectRatio=(b.options||{}).aspectRatio||null,d.legendHeight=(b.options||{}).legendHeight||50,d.mapOptions=g(),d.mapOptions=angular.extend(d.mapOptions,b),d.datamap=new c(d.mapOptions),d.mapOptions.responsive?a.addEventListener("resize",d.api.resize):a.removeEventListener("resize",d.api.resize),d.api.updatePlugins(d.datamap),d.api.refreshOptions(b.options),d.api.updateWithData(b.data)},updatePlugins:function(a){if(d.plugins){var b=d.pluginData||{};angular.forEach(d.plugins,function(c,d){a.addPlugin(d,c),a[d](b[d])})}},refreshOptions:function(a){a&&(a.labels&&d.datamap.labels({labelColor:a.labelColor?a.labelColor:"#333333",fontSize:a.labelSize?a.labelSize:12}),a.legend&&d.datamap.legend())},resize:function(){d.datamap.resize()},updateWithData:function(a){d.datamap.updateChoropleth(a),d.api.updatePlugins(d.datamap)},clearElement:function(){d.datamap=null,e.empty().css({position:"relative",display:"block","padding-bottom":d.legendHeight+"px"})},zoomClick:function(a,b){a=a||"reset",b=b||1.2;var c=[e[0].offsetWidth/2,e[0].offsetHeight/2],f=h.scale(),g=h.translate(),i=h.scaleExtent();if("reset"===a)return h.scale(1).translate([0,0]),d.datamap.svg.selectAll("g").attr("transform","translate("+[0,0]+")scale(1)"),!1;"out"===a&&(b=1/b);var j=f*b;if(j<i[0]||j===i[1])return!1;var k=Math.max(i[0],Math.min(i[1],j));k!==j&&(j=k,b=j/f);var l=(g[0]-c[0])*b+c[0],m=(g[1]-c[1])*b+c[1];h.scale(j).translate([l,m]),d.datamap.svg.selectAll("g").attr("transform","translate("+[l,m]+")scale("+j+")")}},d.$watch("map",function(a,b){a&&!angular.equals({},a)&&(!d.datamap||angular.equals(a.data,b.data)?d.api.refresh(a):(a.options||{}).staticGeoData?d.api.updateWithData(a.data):d.api.refresh(a))},!0),d.$watch("pluginData",function(){d.api.updatePlugins(d.datamap)},!0)}}}])});